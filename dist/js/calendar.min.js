angular.module("ui.rCalendar",[]).constant("calendarConfig",{formatDay:"dd",formatDayHeader:"EEE",formatDayTitle:"MMMM dd, yyyy",formatWeekTitle:"MMMM yyyy, Week w",formatMonthTitle:"MMMM yyyy",formatWeekViewDayHeader:"EEE d",formatHourColumn:"ha",calendarMode:"month",showWeeks:!1,showEventDetail:!0,startingDay:0,allDayLabel:"all day",noEventsLabel:"No Events",eventSource:null,queryMode:"local",step:30}).controller("ui.rCalendar.CalendarController",["$scope","$attrs","$parse","$interpolate","$log","dateFilter","calendarConfig",function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=a,d=b;return(a.startIndex>b.startIndex||a.startIndex===b.startIndex&&a.startOffset>b.startOffset)&&(c=b,d=a),!(c.endIndex<=d.startIndex)&&!(c.endIndex-d.startIndex==1&&c.endOffset+d.startOffset>=k.hourParts)}function i(a){var b,c,d,e=a.length,f=0,g=new Array(e);for(b=0;b<e;b+=1){for(d=0;d<f;d+=1)g[d]=!1;for(c=0;c<b;c+=1)h(a[b],a[c])&&(g[a[c].position]=!0);for(d=0;d<f&&g[d];d+=1);a[b].position=d<f?d:f++}}function j(a,b){var c,d,e,f,g,h,i,j=24*b,k=new Array(j);for(a.sort(function(a,b){return b.position-a.position}),e=0;e<j;e+=1)k[e]={calculated:!1,events:[]};for(g=a.length,e=0;e<g;e+=1)for(c=a[e],d=c.startIndex*b+c.startOffset;d<c.endIndex*b-c.endOffset;)k[d].events.push(c),d+=1;for(e=0;e<g;){if(c=a[e],!c.overlapNumber){var l=c.position+1;c.overlapNumber=l;for(var m=[c];c=m.shift();)for(d=c.startIndex*b+c.startOffset;d<c.endIndex*b-c.endOffset;){if(!k[d].calculated&&(k[d].calculated=!0,k[d].events))for(h=k[d].events.length,f=0;f<h;f+=1)i=k[d].events[f],i.overlapNumber||(i.overlapNumber=l,m.push(i));d+=1}}e+=1}}var k=this,l={$setViewValue:angular.noop};if(angular.forEach(["formatDay","formatDayHeader","formatDayTitle","formatWeekTitle","formatMonthTitle","formatWeekViewDayHeader","formatHourColumn","allDayLabel","noEventsLabel"],function(c,e){k[c]=angular.isDefined(b[c])?d(b[c])(a.$parent):g[c]}),angular.forEach(["showWeeks","showEventDetail","startingDay","eventSource","queryMode","step"],function(c,d){k[c]=angular.isDefined(b[c])?a.$parent.$eval(b[c]):g[c]}),k.hourParts=1,60!==k.step&&30!==k.step&&15!==k.step)throw new Error("Invalid step parameter: "+k.step);k.hourParts=Math.floor(60/k.step);var m=a.$parent.$watch(b.eventSource,function(a){k.onEventSourceChanged(a)});a.$on("$destroy",m),a.calendarMode=a.calendarMode||g.calendarMode,angular.isDefined(b.initDate)&&(k.currentCalendarDate=a.$parent.$eval(b.initDate)),k.currentCalendarDate||(k.currentCalendarDate=new Date,b.ngModel&&!a.$parent.$eval(b.ngModel)&&c(b.ngModel).assign(a.$parent,k.currentCalendarDate)),k.init=function(a){l=a,l.$render=function(){k.render()}},k.render=function(){if(l.$modelValue){var a=new Date(l.$modelValue),b=!isNaN(a);b?this.currentCalendarDate=a:e.error('"ng-model" value must be a Date object, a number of milliseconds since 01.01.1970 or a string representing an RFC2822 or ISO 8601 date.'),l.$setValidity("date",b)}this.refreshView()},k.refreshView=function(){this.mode&&(this.range=this._getRange(this.currentCalendarDate),this._refreshView(),this.rangeChanged())},k.split=function(a,b){for(var c=[];a.length>0;)c.push(a.splice(0,b));return c},k.onEventSourceChanged=function(a){k.eventSource=a,k._onDataLoaded&&k._onDataLoaded()},a.move=function(b){var c,d=k.mode.step,e=k.currentCalendarDate,f=e.getFullYear()+b*(d.years||0),g=e.getMonth()+b*(d.months||0),h=e.getDate()+b*(d.days||0);e.setFullYear(f,g,h),"month"===a.calendarMode&&(c=new Date(f,g+1,1),c.getTime()<=e.getTime()&&(k.currentCalendarDate=new Date(c-864e5))),l.$setViewValue(k.currentCalendarDate),k.refreshView()},k.move=function(b){a.move(b)},k.rangeChanged=function(){"local"===k.queryMode?k.eventSource&&k._onDataLoaded&&k._onDataLoaded():"remote"===k.queryMode&&a.rangeChanged&&a.rangeChanged({startTime:this.range.startTime,endTime:this.range.endTime})},k.placeEvents=function(a){i(a),j(a,k.hourParts)},k.placeAllDayEvents=function(a){i(a)}}]).directive("calendar",function(){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/calendar.html",scope:{calendarMode:"=",rangeChanged:"&",eventSelected:"&",timeSelected:"&"},require:["calendar","?^ngModel"],controller:"ui.rCalendar.CalendarController",link:function(a,b,c,d){var e=d[0],f=d[1];f&&e.init(f),a.$on("changeDate",function(a,b){e.move(b)}),a.$on("eventSourceChanged",function(a,b){e.onEventSourceChanged(b)})}}}).directive("monthview",["dateFilter",function(a){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/month.html",require:["^calendar","?^ngModel"],link:function(b,c,d,e){function f(a,b){var c=new Array(b),d=new Date(a),e=0;for(d.setHours(12);e<b;)c[e++]=new Date(d),d.setDate(d.getDate()+1);return c}function g(b,c){return{date:b,label:a(b,c),selected:0===j.compare(b,j.currentCalendarDate),current:0===j.compare(b,new Date)}}function h(a,b){return a.allDay?1:b.allDay?-1:a.startTime.getTime()-b.startTime.getTime()}function i(a){var b=new Date(a.getFullYear(),0,1).getDay(),c=new Date(a.getFullYear(),0,(b<=4?5:12)-b),d=new Date(a.getFullYear(),a.getMonth(),a.getDate()+(4-a.getDay())),e=d-c;return 1+Math.round(e/6048e5)}var j=e[0],k=e[1];b.showWeeks=j.showWeeks,b.showEventDetail=j.showEventDetail,b.noEventsLabel=j.noEventsLabel,b.allDayLabel=j.allDayLabel,j.mode={step:{months:1}},b.$watch("selectedDate",function(a){a&&b.$root.$broadcast("calendar-current-date",{date:b.selectedDate})}),b.select=function(a){var c=b.rows,d=a.date,e=a.events;if(c){var f=j.currentCalendarDate,g=f.getMonth(),h=f.getFullYear(),i=d.getMonth(),l=d.getFullYear(),m=0;if(h===l?g!==i&&(m=g<i?1:-1):m=h<l?1:-1,j.currentCalendarDate=d,k&&k.$setViewValue(d),0===m)for(var n=0;n<6;n+=1)for(var o=0;o<7;o+=1){var p=0===j.compare(d,c[n][o].date);c[n][o].selected=p,p&&(b.selectedDate=c[n][o])}else j.refreshView();b.timeSelected&&b.timeSelected({selectedTime:d,events:e})}},j._refreshView=function(){for(var c=j.range.startTime,d=c.getDate(),e=(c.getMonth()+(1!==d?1:0))%12,h=c.getFullYear()+(1!==d&&0===e?1:0),k=f(c,42),l=0;l<42;l++)k[l]=angular.extend(g(k[l],j.formatDay),{secondary:k[l].getMonth()!==e});b.labels=new Array(7);for(var m=0;m<7;m++)b.labels[m]=a(k[m].date,j.formatDayHeader);var n=new Date(h,e,1);if(b.$parent.title=n,b.rows=j.split(k,7),b.showWeeks){b.weekNumbers=[];for(var o=(11-j.startingDay)%7,p=b.rows.length,q=0;q<p;q++)b.weekNumbers.push(i(b.rows[q][o].date))}},j._onDataLoaded=function(){var a,c,d=j.eventSource,e=d?d.length:0,f=j.range.startTime,g=j.range.endTime,i=new Date(Date.UTC(f.getFullYear(),f.getMonth(),f.getDate())),k=new Date(Date.UTC(g.getFullYear(),g.getMonth(),g.getDate())),l=b.rows,m=864e5,n=.001,o=!1;if(l.hasEvent)for(a=0;a<6;a+=1)for(c=0;c<7;c+=1)l[a][c].hasEvent&&(l[a][c].events=null,l[a][c].hasEvent=!1);for(var p=0;p<e;p+=1){var q,r,s=d[p],t=new Date(s.startTime),u=new Date(s.endTime);if(s.allDay){if(u<=i||t>=k)continue;q=i,r=k}else{if(u<=f||t>=g)continue;q=f,r=g}var v,w;t<=q?w=0:(v=t-q,s.allDay||(v-=6e4*(t.getTimezoneOffset()-q.getTimezoneOffset())),w=v/m);var x;u>=r?(v=r-q,s.allDay||(v-=6e4*(r.getTimezoneOffset()-q.getTimezoneOffset())),x=v/m):(v=u-q,s.allDay||(v-=6e4*(u.getTimezoneOffset()-q.getTimezoneOffset())),x=v/m);for(var y,z=Math.floor(w);z<x-n;){var A=Math.floor(z/7),B=Math.floor(z%7);l[A][B].hasEvent=!0,y=l[A][B].events,y?y.push(s):(y=[],y.push(s),l[A][B].events=y),z+=1}}for(a=0;a<6;a+=1)for(c=0;c<7;c+=1)l[a][c].hasEvent&&(o=!0,l[a][c].events.sort(h));l.hasEvent=o;var C=!1;for(a=0;a<6;a+=1){for(c=0;c<7;c+=1)if(l[a][c].selected){b.selectedDate=l[a][c],C=!0;break}if(C)break}},j.compare=function(a,b){return new Date(a.getFullYear(),a.getMonth(),a.getDate())-new Date(b.getFullYear(),b.getMonth(),b.getDate())},j._getRange=function(a){var b,c=a.getFullYear(),d=a.getMonth(),e=new Date(c,d,1),f=j.startingDay-e.getDay(),g=f>0?7-f:-f,h=new Date(e);return g>0&&h.setDate(1-g),b=new Date(h),b.setDate(b.getDate()+42),{startTime:h,endTime:b}},j.refreshView()}}}]).directive("weekview",["dateFilter","$timeout",function(a,b){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/week.html",require:"^calendar",link:function(c,d,e,f){function g(){var a=d.children(),b=a[1].children[1],e=b.offsetWidth-b.clientWidth,f=a[2],g=f.offsetWidth-f.clientWidth,h=e||g||0;h>0&&(c.gutterWidth=h,c.allDayEventGutterWidth=e<=0?h:0,c.normalGutterWidth=g<=0?h:0)}function h(a,b){var c=new Array(b),d=new Date(a),e=0;for(d.setHours(12);e<b;)c[e++]={date:new Date(d)},d.setDate(d.getDate()+1);return c}function i(a){for(var b,c,d=[],e=a.getHours(),f=a.getDate(),g=0;g<24;g+=1){b=[];for(var h=0;h<7;h+=1)c=new Date(a.getTime()),c.setHours(e+g),c.setDate(f+h),b.push({time:c});d.push(b)}return d}function j(a,b){return a.startOffset-b.startOffset}function k(a){var b=new Date(a);b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1}c.formatWeekViewDayHeader=f.formatWeekViewDayHeader,c.formatHourColumn=f.formatHourColumn,c.allDayLabel=f.allDayLabel,b(function(){g()}),f.mode={step:{days:7}},c.hourParts=f.hourParts,c.select=function(a,b){c.timeSelected&&c.timeSelected({selectedTime:a,events:b})},f._onDataLoaded=function(){var a,d,e,h=f.eventSource,i=h?h.length:0,k=f.range.startTime,l=f.range.endTime,m=new Date(Date.UTC(k.getFullYear(),k.getMonth(),k.getDate())),n=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),o=c.rows,p=c.dates,q=36e5,r=864e5,s=.016,t=!1,u=!1;if(o.hasEvent){for(d=0;d<7;d+=1)for(e=0;e<24;e+=1)o[e][d].events&&(o[e][d].events=null);o.hasEvent=!1}if(p.hasEvent){for(d=0;d<7;d+=1)p[d].events&&(p[d].events=null);p.hasEvent=!1}for(var v=0;v<i;v+=1){var w=h[v],x=new Date(w.startTime),y=new Date(w.endTime);if(w.allDay){if(y<=m||x>=n)continue;t=!0;var z;z=x<=m?0:Math.floor((x-m)/r);var A;A=y>=n?Math.ceil((n-m)/r):Math.ceil((y-m)/r);var B={event:w,startIndex:z,endIndex:A};a=p[z].events,a?a.push(B):(a=[],a.push(B),p[z].events=a)}else{if(y<=k||x>=l)continue;u=!0;var C,D;x<=k?D=0:(C=x-k-6e4*(x.getTimezoneOffset()-k.getTimezoneOffset()),D=C/q);var E;y>=l?(C=l-k-6e4*(l.getTimezoneOffset()-k.getTimezoneOffset()),E=C/q):(C=y-k-6e4*(y.getTimezoneOffset()-k.getTimezoneOffset()),E=C/q);var F,G=Math.floor(D),H=Math.ceil(E-s),I=G%24,J=Math.floor(G/24),K=24*J,L=0,M=0;1!==f.hourParts&&(L=Math.floor((D-G)*f.hourParts));do{K+=24,K<=H?F=24:(F=H%24,1!==f.hourParts&&(M=Math.floor((H-E)*f.hourParts)));var N={event:w,startIndex:I,endIndex:F,startOffset:L,endOffset:M};a=o[I][J].events,a?a.push(N):(a=[],a.push(N),o[I][J].events=a),I=0,L=0,J+=1}while(K<H)}}if(u)for(d=0;d<7;d+=1){var O=[];for(e=0;e<24;e+=1)o[e][d].events&&(o[e][d].events.sort(j),O=O.concat(o[e][d].events));O.length>0&&(o.hasEvent=!0,f.placeEvents(O))}if(t){var P=[];for(d=0;d<7;d+=1)p[d].events&&(P=P.concat(p[d].events));P.length>0&&(p.hasEvent=!0,f.placeAllDayEvents(P))}b(function(){g()})},f._refreshView=function(){var b,d,e=f.range.startTime,g=h(e,7),j="w";c.rows=i(e),c.dates=g,b=f.formatWeekTitle.indexOf(j),d=a(e,f.formatWeekTitle),-1!==b&&(d=d.replace(j,k(e))),c.$parent.title=d},f._getRange=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate(),e=a.getDay();return{startTime:new Date(b,c,d-e),endTime:new Date(b,c,d-e+7)}},f.refreshView()}}}]).directive("dayview",["dateFilter","$timeout",function(a,b){"use strict";return{restrict:"EA",replace:!0,templateUrl:"template/rcalendar/day.html",require:"^calendar",link:function(c,d,e,f){function g(){var a=d.children(),b=a[0].children[1],e=b.offsetWidth-b.clientWidth,f=a[1],g=f.offsetWidth-f.clientWidth,h=e||g||0;h>0&&(c.allDayEventGutterWidth=e<=0?h:0,c.normalGutterWidth=g<=0?h:0)}function h(a){for(var b,c=[],d=a.getHours(),e=a.getDate(),f=0;f<24;f+=1)b=new Date(a.getTime()),b.setHours(d+f),b.setDate(e),c.push({time:b});return c}function i(a,b){return a.startOffset-b.startOffset}c.formatHourColumn=f.formatHourColumn,c.allDayLabel=f.allDayLabel,b(function(){g()}),f.mode={step:{days:1}},c.hourParts=f.hourParts,c.select=function(a,b){c.timeSelected&&c.timeSelected({selectedTime:a,events:b})},f._onDataLoaded=function(){var a,d,e=f.eventSource,h=e?e.length:0,j=f.range.startTime,k=f.range.endTime,l=new Date(Date.UTC(j.getFullYear(),j.getMonth(),j.getDate())),m=new Date(Date.UTC(k.getFullYear(),k.getMonth(),k.getDate())),n=c.rows,o=[],p=36e5,q=.016,r=!1;if(n.hasEvent){for(d=0;d<24;d+=1)n[d].events&&(n[d].events=null);n.hasEvent=!1}for(var s=0;s<h;s+=1){var t=e[s],u=new Date(t.startTime),v=new Date(t.endTime);if(t.allDay){if(v<=l||u>=m)continue;o.push({event:t})}else{if(v<=j||u>=k)continue;r=!0;var w,x;u<=j?x=0:(w=u-j-6e4*(u.getTimezoneOffset()-j.getTimezoneOffset()),x=w/p);var y;v>=k?(w=k-j-6e4*(k.getTimezoneOffset()-j.getTimezoneOffset()),y=w/p):(w=v-j-6e4*(v.getTimezoneOffset()-j.getTimezoneOffset()),y=w/p);var z=Math.floor(x),A=Math.ceil(y-q),B=0,C=0;1!==f.hourParts&&(B=Math.floor((x-z)*f.hourParts),C=Math.floor((A-y)*f.hourParts));var D={event:t,startIndex:z,endIndex:A,startOffset:B,endOffset:C};a=n[z].events,a?a.push(D):(a=[],a.push(D),n[z].events=a)}}if(r){var E=[];for(d=0;d<24;d+=1)n[d].events&&(n[d].events.sort(i),E=E.concat(n[d].events));E.length>0&&(n.hasEvent=!0,f.placeEvents(E))}c.allDayEvents=o,b(function(){g()})},f._refreshView=function(){var b=f.range.startTime;c.rows=h(b),c.allDayEvents=[],c.dates=[b],c.$parent.title=a(b,f.formatDayTitle)},f._getRange=function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate();return{startTime:new Date(b,c,d),endTime:new Date(b,c,d+1)}},f.refreshView()}}}]).filter("germanDate",function(){"use strict";return function(a){const b=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];if(a){var c=new Date(a),d=c.getMonth(),e=c.getFullYear();return b[d]+" "+e}}});